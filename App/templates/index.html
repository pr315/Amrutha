<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Home Page</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="./static/test.css">
    <!-- Your CSS and JS files here -->
</head>
<body id="page-top">
        <header>
        </header>
        <div class="content">
            {% if logged_in %}
                <nav class="navbar navbar-dark bg-primary">
                    <a href="/" class="navbar-brand">Home</a>
                    <a href="/" class="navbar-brand">Weekly Trend</a>
                    <a href="/" class="navbar-brand">Monthly Trend</a> 
                    <a class="navbar-brand" > Welcome, {{ logged_in_user }}</a>
                    <a href="/logout" class="navbar-brand">Sign Out</a>
                </nav>
            
                <br>
                </br>
                <!-- <div class="dashboard-container"> -->
                <h1>xdrc-use1-nbl01</h1>
                <canvas id="myChart" width="100" height="12"></canvas>
                <script>
                    fetch('/nightly')
                        .then(response => response.json())
                        .then(data => {
                            console.log('Received data:', data); // Log received data
            
                            // Extract service names and corresponding passed test percentages
                            const serviceNames = data.map(item => item['Service Name']);
                            const passedTests = data.map(item => {
                                const value = item['Passed Tests %'];
                                // Handling 'FAILED START' values and parsing percentages (modify as needed)
                                return value === null || value === 'FAILED START' ? 0 : parseFloat(value.replace(/[^\d.]/g, ''));
                            });
            
                            // Create Chart.js bar chart
                            const ctx = document.getElementById('myChart').getContext('2d');
                            new Chart(ctx, {
                                type: 'bar',
                                data: {
                                    labels: serviceNames,
                                    datasets: [{
                                        label: 'Passed Tests %',
                                        data: passedTests,
                                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                                        borderColor: 'rgba(54, 162, 235, 1)',
                                        borderWidth: 1
                                    }]
                                },
                                options: {
                                    scales: {
                                        y: {
                                            beginAtZero: true,
                                            suggestedMax: 100 // Set max value for y-axis
                                        }
                                    }
                                }
                            });
                        })
                        .catch(error => console.error('Error fetching data:', error));
                </script>
                <h1>xdrc-use1-rel01</h1>
                <canvas id="myChart2" width="100" height="12"></canvas> 
                <script>
                    fetch('/rel')
                        .then(response => response.json())
                        .then(data => {
                            console.log('Received data:', data); // Log received data
            
                            // Extract service names and corresponding passed test percentages
                            const serviceNames = data.map(item => item['Service Name']);
                            const passedTests = data.map(item => {
                                const value = item['Passed Tests %'];
                                // Handling 'FAILED START' values and parsing percentages (modify as needed)
                                return value === null || value === 'FAILED START' ? 0 : parseFloat(value.replace(/[^\d.]/g, ''));
                            });
            
                            // Create Chart.js bar chart
                            const ctx = document.getElementById('myChart2').getContext('2d');
                            new Chart(ctx, {
                                type: 'bar',
                                data: {
                                    labels: serviceNames,
                                    datasets: [{
                                        label: 'Passed Tests %',
                                        data: passedTests,
                                        backgroundColor: 'rgba(50, 150, 220, 0.2)',
                                        borderColor: 'rgba(54, 162, 235, 1)',
                                        borderWidth: 1
                                    }]
                                },
                                options: {
                                    scales: {
                                        y: {
                                            beginAtZero: true,
                                            suggestedMax: 100 // Set max value for y-axis
                                        }
                                    }
                                }
                            });
                        })
                        .catch(error => console.error('Error fetching data:', error));
                </script>
                <h1>xdrc-use1-dev01</h1>
                <canvas id="myChart3" width="100" height="12"></canvas> 
                <script>
                    fetch('/rel')
                        .then(response => response.json())
                        .then(data => {
                            console.log('Received data:', data); // Log received data
            
                            // Extract service names and corresponding passed test percentages
                            const serviceNames = data.map(item => item['Service Name']);
                            const passedTests = data.map(item => {
                                const value = item['Passed Tests %'];
                                // Handling 'FAILED START' values and parsing percentages (modify as needed)
                                return value === null || value === 'FAILED START' ? 0 : parseFloat(value.replace(/[^\d.]/g, ''));
                            });
            
                            // Create Chart.js bar chart
                            const ctx = document.getElementById('myChart3').getContext('2d');
                            new Chart(ctx, {
                                type: 'bar',
                                data: {
                                    labels: serviceNames,
                                    datasets: [{
                                        label: 'Passed Tests %',
                                        data: passedTests,
                                        backgroundColor: 'rgba(50, 150, 220, 0.2)',
                                        borderColor: 'rgba(54, 162, 235, 1)',
                                        borderWidth: 1
                                    }]
                                },
                                options: {
                                    scales: {
                                        y: {
                                            beginAtZero: true,
                                            suggestedMax: 100 // Set max value for y-axis
                                        }
                                    }
                                }
                            });
                        })
                        .catch(error => console.error('Error fetching data:', error));
                </script>
                <!-- </div> -->
                  
            {% else %}
                <nav class="navbar navbar-dark bg-primary">
                <a class="navbar-brand">Infrastructure Dashboard</a>
                <form class="form-inline">
                <button class="btn btn-outline-success my-2 my-sm-0" type="submit"><a href="/login">Login</a></button>
                </form>
                </nav>
            {% endif %}
        </div>

    <!-- Your JS scripts here -->
</body>
</html>
